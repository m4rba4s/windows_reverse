#include <windows.h>
#include <stdio.h>

char* generate_flag(int level) {
    static char flag[64];
    DWORD seed = GetTickCount() ^ 0xDEADBEEF;
    sprintf(flag, "flag{level_%d_%08x}", level, seed);
    return flag;
}

char* decrypt_string(char* encrypted, int key) {
    static char decrypted[256];
    int i = 0;
    while (encrypted[i]) {
        decrypted[i] = encrypted[i] ^ key;
        i++;
    }
    decrypted[i] = 0;
    return decrypted;
}

int main() {
    char msg1[] = {0x7b, 0x4c, 0x41, 0x42, 0x2d, 0x39, 0x7d, 0x20, 0x4c, 0x65, 0x76, 0x65, 0x6c, 0x20, 0x34, 0x3a, 0x20, 0x54, 0x69, 0x6d, 0x69, 0x6e, 0x67, 0x20, 0x41, 0x74, 0x74, 0x61, 0x63, 0x6b, 0x0a, 0x00};
    char msg2[] = {0x7b, 0x4c, 0x41, 0x42, 0x2d, 0x39, 0x7d, 0x20, 0x50, 0x65, 0x72, 0x66, 0x6f, 0x72, 0x6d, 0x69, 0x6e, 0x67, 0x20, 0x74, 0x69, 0x6d, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x68, 0x65, 0x63, 0x6b, 0x73, 0x2e, 0x2e, 0x2e, 0x0a, 0x00};
    char msg3[] = {0x7b, 0x4c, 0x41, 0x42, 0x2d, 0x39, 0x7d, 0x20, 0x54, 0x69, 0x6d, 0x69, 0x6e, 0x67, 0x20, 0x63, 0x68, 0x65, 0x63, 0x6b, 0x20, 0x66, 0x61, 0x69, 0x6c, 0x65, 0x64, 0x21, 0x0a, 0x00};
    char msg4[] = {0x7b, 0x4c, 0x41, 0x42, 0x2d, 0x39, 0x7d, 0x20, 0x41, 0x6c, 0x6c, 0x20, 0x63, 0x68, 0x65, 0x63, 0x6b, 0x73, 0x20, 0x70, 0x61, 0x73, 0x73, 0x65, 0x64, 0x21, 0x0a, 0x00};
    
    printf("%s", decrypt_string(msg1, 0x13));
    printf("%s", decrypt_string(msg2, 0x13));
    
    DWORD start = GetTickCount();
    
    if (!IsDebuggerPresent()) {
        printf("[!] Debugger not detected!\n");
        return 1;
    }
    
    Sleep(50);
    
    DWORD end = GetTickCount();
    DWORD elapsed = end - start;
    
    if (elapsed > 200) {
        printf("%s", decrypt_string(msg3, 0x13));
        return 1;
    }
    
    printf("%s", decrypt_string(msg4, 0x13));
    printf("Flag: %s\n", generate_flag(4));
    
    system("pause");
    return 0;
} 